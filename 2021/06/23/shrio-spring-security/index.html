<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Shrio VS Spring Security [转] | Jerrio's Blog</title><script src="https://cdn.bootcss.com/valine/1.4.4/Valine.min.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/mermaid/8.8.2/mermaid.min.js"></script><script>mermaid.initialize({
  startOnLoad: true
  , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 5.4.0"></head><body><header><nav><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/monitor/">Monitor</a></nav></header><main><article><div id="post-bg"><div id="post-title"><h1>Shrio VS Spring Security [转]</h1><hr></div><div id="post-content"><h2 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a>1. Overview</h2><p>Security is a primary concern in the world of application development, especially in the area of enterprise web and mobile applications.</p>
<p>In this quick tutorial, <strong>we’ll compare two popular Java Security frameworks – <a target="_blank" rel="noopener" href="https://shiro.apache.org/">Apache Shiro</a> and <a target="_blank" rel="noopener" href="https://spring.io/projects/spring-security">Spring Security</a>.</strong></p>
<h2 id="2-A-Little-Background"><a href="#2-A-Little-Background" class="headerlink" title="2. A Little Background"></a>2. A Little Background</h2><p>Apache Shiro was born in 2004 as JSecurity and was accepted by the Apache Foundation in 2008. To date, it has seen many releases, the latest as of writing this is 1.5.3.</p>
<p>Spring Security started as Acegi in 2003 and was incorporated into the Spring Framework with its first public release in 2008. Since its inception, it has gone through several iterations and the current GA version as of writing this is 5.3.2.</p>
<p>Both technologies offer <strong>authentication and authorization support along with cryptography and session management solutions</strong>. Additionally, Spring Security provides first-class protection against attacks such as CSRF and session fixation.</p>
<p>In the next few sections, we’ll see examples of how the two technologies handle authentication and authorization. To keep things simple, we’ll be using basic Spring Boot based MVC applications with FreeMarker templates.</p>
<h2 id="3-Configuring-Apache-Shiro"><a href="#3-Configuring-Apache-Shiro" class="headerlink" title="3. Configuring Apache Shiro"></a>3. Configuring Apache Shiro</h2><p>To start with, let’s see how configurations differ between the two frameworks.</p>
<h3 id="3-1-Maven-Dependencies"><a href="#3-1-Maven-Dependencies" class="headerlink" title="3.1. Maven Dependencies"></a>3.1. Maven Dependencies</h3><p>Since we’ll use Shiro in a Spring Boot App, we’ll need its starter and the shiro-core module:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;<br>    &lt;artifactId&gt;shiro-spring-boot-web-starter&lt;/artifactId&gt;<br>    &lt;version&gt;1.5.3&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;<br>    &lt;artifactId&gt;shiro-core&lt;/artifactId&gt;<br>    &lt;version&gt;1.5.3&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure>
<p>The latest versions can be found on Maven Central.</p>
<h3 id="3-2-Creating-a-Realm"><a href="#3-2-Creating-a-Realm" class="headerlink" title="3.2. Creating a Realm"></a>3.2. Creating a Realm</h3><p>To declare users with their roles and permissions in-memory, we need to create a realm extending Shiro’s JdbcRealm. We’ll define two users – Tom and Jerry, with roles USER and ADMIN, respectively:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JdbcRealm</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; credentials = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>    <span class="hljs-keyword">private</span> Map&lt;String, Set&gt; roles = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>    <span class="hljs-keyword">private</span> Map&lt;String, Set&gt; permissions = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br><br>    &#123;<br>        credentials.put(<span class="hljs-string">&quot;Tom&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>);<br>        credentials.put(<span class="hljs-string">&quot;Jerry&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>);<br><br>        roles.put(<span class="hljs-string">&quot;Jerry&quot;</span>, <span class="hljs-keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="hljs-string">&quot;ADMIN&quot;</span>)));<br>        roles.put(<span class="hljs-string">&quot;Tom&quot;</span>, <span class="hljs-keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="hljs-string">&quot;USER&quot;</span>)));<br><br>        permissions.put(<span class="hljs-string">&quot;ADMIN&quot;</span>, <span class="hljs-keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="hljs-string">&quot;READ&quot;</span>, <span class="hljs-string">&quot;WRITE&quot;</span>)));<br>        permissions.put(<span class="hljs-string">&quot;USER&quot;</span>, <span class="hljs-keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="hljs-string">&quot;READ&quot;</span>)));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Next, to enable retrieval of this authentication and authorization, we need to override a few methods:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken token)</span> </span><br><span class="hljs-function">  <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;<br>    UsernamePasswordToken userToken = (UsernamePasswordToken) token;<br><br>    <span class="hljs-keyword">if</span> (userToken.getUsername() == <span class="hljs-keyword">null</span> || userToken.getUsername().isEmpty() ||<br>      !credentials.containsKey(userToken.getUsername())) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnknownAccountException(<span class="hljs-string">&quot;User doesn&#x27;t exist&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SimpleAuthenticationInfo(userToken.getUsername(), <br>      credentials.get(userToken.getUsername()), getName());<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principals)</span> </span>&#123;<br>    Set roles = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();<br>    Set permissions = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();<br><br>    <span class="hljs-keyword">for</span> (Object user : principals) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            roles.addAll(getRoleNamesForUser(<span class="hljs-keyword">null</span>, (String) user));<br>            permissions.addAll(getPermissions(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, roles));<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            logger.error(e.getMessage());<br>        &#125;<br>    &#125;<br>    SimpleAuthorizationInfo authInfo = <span class="hljs-keyword">new</span> SimpleAuthorizationInfo(roles);<br>    authInfo.setStringPermissions(permissions);<br>    <span class="hljs-keyword">return</span> authInfo;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>The method <em>doGetAuthorizationInfo</em> is using a couple of helper methods to get the user’s roles and permissions:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> Set <span class="hljs-title">getRoleNamesForUser</span><span class="hljs-params">(Connection conn, String username)</span> </span><br><span class="hljs-function">  <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>    <span class="hljs-keyword">if</span> (!roles.containsKey(username)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SQLException(<span class="hljs-string">&quot;User doesn&#x27;t exist&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> roles.get(username);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> Set <span class="hljs-title">getPermissions</span><span class="hljs-params">(Connection conn, String username, Collection roles)</span> </span><br><span class="hljs-function">  <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>    Set userPermissions = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (String role : roles) &#123;<br>        <span class="hljs-keyword">if</span> (!permissions.containsKey(role)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SQLException(<span class="hljs-string">&quot;Role doesn&#x27;t exist&quot;</span>);<br>        &#125;<br>        userPermissions.addAll(permissions.get(role));<br>    &#125;<br>    <span class="hljs-keyword">return</span> userPermissions;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Next, we need to include this <em>CustomRealm</em> as a bean in our Boot Application:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Realm <span class="hljs-title">customRealm</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CustomRealm();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Additionally, to configure authentication for our endpoints, we need another bean:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ShiroFilterChainDefinition <span class="hljs-title">shiroFilterChainDefinition</span><span class="hljs-params">()</span> </span>&#123;<br>    DefaultShiroFilterChainDefinition filter = <span class="hljs-keyword">new</span> DefaultShiroFilterChainDefinition();<br><br>    filter.addPathDefinition(<span class="hljs-string">&quot;/home&quot;</span>, <span class="hljs-string">&quot;authc&quot;</span>);<br>    filter.addPathDefinition(<span class="hljs-string">&quot;/**&quot;</span>, <span class="hljs-string">&quot;anon&quot;</span>);<br>    <span class="hljs-keyword">return</span> filter;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Here, using a <em>DefaultShiroFilterChainDefinition</em> instance, we specified that our <em>/home</em> endpoint can only be accessed by authenticated users.</p>
<p>That’s all we need for the configuration, Shiro does the rest for us.</p>
<h2 id="4-Configuring-Spring-Security"><a href="#4-Configuring-Spring-Security" class="headerlink" title="4. Configuring Spring Security"></a>4. Configuring Spring Security</h2><p>Now let’s see how to achieve the same in Spring.</p>
<h3 id="4-1-Maven-Dependencies"><a href="#4-1-Maven-Dependencies" class="headerlink" title="4.1. Maven Dependencies"></a>4.1. Maven Dependencies</h3><p>First, the dependencies:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br><br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure>
<p>The latest versions can be found on <a target="_blank" rel="noopener" href="https://search.maven.org/classic/#search%7Cga%7C1%7Cg%3A%22org.springframework.boot%22%20AND%20a%3A%22spring-boot-starter%22">Maven Central</a>.</p>
<h3 id="4-2-Configuration-Class"><a href="#4-2-Configuration-Class" class="headerlink" title="4.2. Configuration Class"></a>4.2. Configuration Class</h3><p>Next, we’ll define our Spring Security configuration in a class <em>SecurityConfig</em>, extending <em>WebSecurityConfigurerAdapter</em>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableWebSecurity</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        http<br>          .authorizeRequests(authorize -&gt; authorize<br>            .antMatchers(<span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-string">&quot;/login&quot;</span>).permitAll()<br>            .antMatchers(<span class="hljs-string">&quot;/home&quot;</span>, <span class="hljs-string">&quot;/logout&quot;</span>).authenticated()<br>            .antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>).hasRole(<span class="hljs-string">&quot;ADMIN&quot;</span>))<br>          .formLogin(formLogin -&gt; formLogin<br>            .loginPage(<span class="hljs-string">&quot;/login&quot;</span>)<br>            .failureUrl(<span class="hljs-string">&quot;/login-error&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        auth.inMemoryAuthentication()<br>          .withUser(<span class="hljs-string">&quot;Jerry&quot;</span>)<br>            .password(passwordEncoder().encode(<span class="hljs-string">&quot;password&quot;</span>))<br>            .authorities(<span class="hljs-string">&quot;READ&quot;</span>, <span class="hljs-string">&quot;WRITE&quot;</span>)<br>            .roles(<span class="hljs-string">&quot;ADMIN&quot;</span>)<br>            .and()<br>          .withUser(<span class="hljs-string">&quot;Tom&quot;</span>)<br>            .password(passwordEncoder().encode(<span class="hljs-string">&quot;password&quot;</span>))<br>            .authorities(<span class="hljs-string">&quot;READ&quot;</span>)<br>            .roles(<span class="hljs-string">&quot;USER&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>As we can see, we built an <em>AuthenticationManagerBuilder</em> object to declare our users with their roles and authorities. Additionally, we encoded the passwords using a <em>BCryptPasswordEncoder</em>.</p>
<p>Spring Security also provides us with its <em>HttpSecurity</em> object for further configurations. For our example, we’ve allowed:</p>
<ul>
<li>everyone to access our <em>index</em> and <em>login</em> pages</li>
<li>only authenticated users to enter the <em>home</em> page and <em>logout</em></li>
<li>only users with ADMIN role to access the <em>admin</em> pages</li>
</ul>
<p>We’ve also defined support for form-based authentication to send users to the <em>login</em> endpoint. In case login fails, our users will be redirected to <em>/login-error.</em></p>
<h2 id="5-Controllers-and-Endpoints"><a href="#5-Controllers-and-Endpoints" class="headerlink" title="5. Controllers and Endpoints"></a>5. Controllers and Endpoints</h2><p>Now let’s have a look at our web controller mappings for the two applications. While they’ll use the same endpoints, some implementations will differ.</p>
<h3 id="5-1-Endpoints-for-View-Rendering"><a href="#5-1-Endpoints-for-View-Rendering" class="headerlink" title="5.1. Endpoints for View Rendering"></a>5.1. Endpoints for View Rendering</h3><p>For endpoints rendering the view, the implementations are the same:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">index</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@GetMapping(&quot;/login&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">showLoginPage</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@GetMapping(&quot;/home&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getMeHome</span><span class="hljs-params">(Model model)</span> </span>&#123;<br>    addUserAttributes(model);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;home&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Both our controller implementations, Shiro as well as Spring Security, return the <em>index.ftl</em> on the root endpoint, <em>login.ftl</em> on the login endpoint, and <em>home.ftl</em> on the home endpoint.</p>
<p>However, the definition of the method <em>addUserAttributes</em> at the <em>/home</em> endpoint will differ between the two controllers. This method introspects the currently logged in user’s attributes.</p>
<p>Shiro provides a <em>SecurityUtils.getSubject</em> to retrieve the current <em>Subject</em>, and its roles and permissions:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addUserAttributes</span><span class="hljs-params">(Model model)</span> </span>&#123;<br>    Subject currentUser = SecurityUtils.getSubject();<br>    String permission = <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">if</span> (currentUser.hasRole(<span class="hljs-string">&quot;ADMIN&quot;</span>)) &#123;<br>        model.addAttribute(<span class="hljs-string">&quot;role&quot;</span>, <span class="hljs-string">&quot;ADMIN&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentUser.hasRole(<span class="hljs-string">&quot;USER&quot;</span>)) &#123;<br>        model.addAttribute(<span class="hljs-string">&quot;role&quot;</span>, <span class="hljs-string">&quot;USER&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (currentUser.isPermitted(<span class="hljs-string">&quot;READ&quot;</span>)) &#123;<br>        permission = permission + <span class="hljs-string">&quot; READ&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (currentUser.isPermitted(<span class="hljs-string">&quot;WRITE&quot;</span>)) &#123;<br>        permission = permission + <span class="hljs-string">&quot; WRITE&quot;</span>;<br>    &#125;<br>    model.addAttribute(<span class="hljs-string">&quot;username&quot;</span>, currentUser.getPrincipal());<br>    model.addAttribute(<span class="hljs-string">&quot;permission&quot;</span>, permission);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>On the other hand, Spring Security provides an <em>Authentication</em> object from its <em>SecurityContextHolder‘s</em> context for this purpose:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addUserAttributes</span><span class="hljs-params">(Model model)</span> </span>&#123;<br>    Authentication auth = SecurityContextHolder.getContext().getAuthentication();<br>    <span class="hljs-keyword">if</span> (auth != <span class="hljs-keyword">null</span> &amp;&amp; !auth.getClass().equals(AnonymousAuthenticationToken.class)) &#123;<br>        User user = (User) auth.getPrincipal();<br>        model.addAttribute(<span class="hljs-string">&quot;username&quot;</span>, user.getUsername());<br>        Collection&lt;GrantedAuthority&gt; authorities = user.getAuthorities();<br><br>        <span class="hljs-keyword">for</span> (GrantedAuthority authority : authorities) &#123;<br>            <span class="hljs-keyword">if</span> (authority.getAuthority().contains(<span class="hljs-string">&quot;USER&quot;</span>)) &#123;<br>                model.addAttribute(<span class="hljs-string">&quot;role&quot;</span>, <span class="hljs-string">&quot;USER&quot;</span>);<br>                model.addAttribute(<span class="hljs-string">&quot;permissions&quot;</span>, <span class="hljs-string">&quot;READ&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (authority.getAuthority().contains(<span class="hljs-string">&quot;ADMIN&quot;</span>)) &#123;<br>                model.addAttribute(<span class="hljs-string">&quot;role&quot;</span>, <span class="hljs-string">&quot;ADMIN&quot;</span>);<br>                model.addAttribute(<span class="hljs-string">&quot;permissions&quot;</span>, <span class="hljs-string">&quot;READ WRITE&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="5-2-POST-Login-Endpoint"><a href="#5-2-POST-Login-Endpoint" class="headerlink" title="5.2. POST Login Endpoint"></a>5.2. POST Login Endpoint</h3><p>In Shiro, we map the credentials the user enters to a POJO:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserCredentials</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-comment">// getters and setters</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>Then we’ll create a <em>UsernamePasswordToken</em> to log the user, or <em>Subject</em>, in:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doLogin</span><span class="hljs-params">(HttpServletRequest req, UserCredentials credentials, RedirectAttributes attr)</span> </span>&#123;<br><br>    Subject subject = SecurityUtils.getSubject();<br>    <span class="hljs-keyword">if</span> (!subject.isAuthenticated()) &#123;<br>        UsernamePasswordToken token = <span class="hljs-keyword">new</span> UsernamePasswordToken(credentials.getUsername(),<br>          credentials.getPassword());<br>        <span class="hljs-keyword">try</span> &#123;<br>            subject.login(token);<br>        &#125; <span class="hljs-keyword">catch</span> (AuthenticationException ae) &#123;<br>            logger.error(ae.getMessage());<br>            attr.addFlashAttribute(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-string">&quot;Invalid Credentials&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/login&quot;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/home&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>On the Spring Security side, this is just a matter of redirection to the home page. Spring’s logging-in process, handled by its <em>UsernamePasswordAuthenticationFilter</em>, is transparent to us:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doLogin</span><span class="hljs-params">(HttpServletRequest req)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/home&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-3-Admin-Only-Endpoint"><a href="#5-3-Admin-Only-Endpoint" class="headerlink" title="5.3. Admin-Only Endpoint"></a>5.3. Admin-Only Endpoint</h3><p>Now let’s look at a scenario where we have to perform role-based access. Let’s say we have an <em>/admin</em> endpoint, access to which should only be allowed for the ADMIN role.</p>
<p>Let’s see how to do this in Shiro:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/admin&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">adminOnly</span><span class="hljs-params">(ModelMap modelMap)</span> </span>&#123;<br>    addUserAttributes(modelMap);<br>    Subject currentUser = SecurityUtils.getSubject();<br>    <span class="hljs-keyword">if</span> (currentUser.hasRole(<span class="hljs-string">&quot;ADMIN&quot;</span>)) &#123;<br>        modelMap.addAttribute(<span class="hljs-string">&quot;adminContent&quot;</span>, <span class="hljs-string">&quot;only admin can view this&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;home&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Here we extracted the currently logged in user, checked if they have the ADMIN role, and added content accordingly.</p>
<p>In Spring Security, there is no need for checking the role programmatically, we’ve already defined who can reach this endpoint in our <em>SecurityConfig</em>. So now, it’s just a matter of adding business logic:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/admin&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">adminOnly</span><span class="hljs-params">(HttpServletRequest req, Model model)</span> </span>&#123;<br>    addUserAttributes(model);<br>    model.addAttribute(<span class="hljs-string">&quot;adminContent&quot;</span>, <span class="hljs-string">&quot;only admin can view this&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;home&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-4-Logout-Endpoint"><a href="#5-4-Logout-Endpoint" class="headerlink" title="5.4. Logout Endpoint"></a>5.4. Logout Endpoint</h3><p>Finally, let’s implement the logout endpoint.</p>
<p>In Shiro, we’ll simply call <em>Subject.logout</em>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/logout&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">logout</span><span class="hljs-params">()</span> </span>&#123;<br>    Subject subject = SecurityUtils.getSubject();<br>    subject.logout();<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>For Spring, we’ve not defined any mapping for logout. In this case, its default logout mechanism kicks in, which is automatically applied since we extended <em>WebSecurityConfigurerAdapter</em> in our configuration.</p>
<h2 id="6-Apache-Shiro-vs-Spring-Security"><a href="#6-Apache-Shiro-vs-Spring-Security" class="headerlink" title="6. Apache Shiro vs Spring Security"></a>6. Apache Shiro vs Spring Security</h2><p>Now that we’ve looked at the implementation differences, let’s look at a few other aspects.</p>
<p>In terms of community support, the <strong>Spring Framework in general has a huge community of developers</strong>, actively involved in its development and usage. Since Spring Security is part of the umbrella, it must enjoy the same advantages. Shiro, though popular, does not have such humongous support.</p>
<p>Concerning documentation, Spring again is the winner.</p>
<p>However, there’s a bit of a learning curve associated with Spring Security. <strong>Shiro, on the other hand, is easy to understand</strong>. For desktop applications, configuration via <a target="_blank" rel="noopener" href="https://shiro.apache.org/configuration.html#Configuration-CreatingaSecurityManagerfromINI">shiro.ini</a> is all the easier.</p>
<p>But again, as we saw in our example snippets, <strong>Spring Security does a great job of keeping business logic and security separate</strong> and truly offers security as a cross-cutting concern.</p>
<h2 id="7-Conclusion"><a href="#7-Conclusion" class="headerlink" title="7. Conclusion"></a>7. Conclusion</h2><p>In this tutorial, <strong>we compared Apache Shiro with Spring Security</strong>.</p>
<p>We’ve just grazed the surface of what these frameworks have to offer and there is a lot to explore further. There are quite a few alternatives out there such as <a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/11/security/java-authentication-and-authorization-service-jaas-reference-guide.html#GUID-2A935F5E-0803-411D-B6BC-F8C64D01A25C">JAAS</a> and <a target="_blank" rel="noopener" href="http://oaccframework.org/">OACC</a>. Still, with its advantages, <a target="_blank" rel="noopener" href="https://www.baeldung.com/security-spring">Spring Security</a> seems to be winning at this point.</p>
<p>As always, source code is available <a target="_blank" rel="noopener" href="https://github.com/eugenp/tutorials/tree/master/apache-shiro">over on GitHub</a>. </p>
<hr>
<p>[转自]<a target="_blank" rel="noopener" href="https://www.baeldung.com/spring-security-vs-apache-shiro">Spring Security vs Apache Shiro</a><br>Author: Sampada Wagde<br>Access date: Jun 23, 2021</p><div id="paginator"></div></div><div id="post-footer"><hr><a href="/2021/05/17/capture-packages-with-mac/">在 Mac 上监听局域网中的数据包 Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div><div id="Valine"></div><script>new Valine({
 el: '#Valine'
 , appId: 'W0Y9YCi6j30MgJlvg32vrRv1-gzGzoHsz'
 , appKey: 'Cm6n1aD1AJ4vD2tO8zgcQJRC'
 , placeholder: '此条评论委托企鹅物流发送'
})</script></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/logo2.png" alt="Logo"></a><h1 id="Dr"><a href="/">Aka. Jerrio</a></h1><section id="link"><a target="_blank" rel="noopener" href="https://github.com/Jerriodaddy"><i class="fa fa-github"> Github </i></a><span> </span><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41835496"><i class="fa fa-bullseye"> CSDN </i></a><span> </span><a href="mailto:jerrio20@outlook.com"><i class="fa fa-envelope"> jerrio20@outlook.com</i></a></section><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">10</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">7</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">6</span></div></section></div><div id="aside-block"></div><footer><nobr><span class="text-title">©</span><span class="text-content">1970 to 9999</span></nobr><wbr><nobr><span class="text-title">ICP</span><span class="text-content">——备案号——</span></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/arknights.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script></body></html>